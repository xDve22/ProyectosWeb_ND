{% extends "base.html" %}
{% block title %}New Job{% endblock %}

{% load static %}

{% block head %}
  <link rel="stylesheet" href="{% static 'jobs/job_create.css' %}">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
{% endblock %}

{% block content %}
<section class="job-create">
  <article class="job-create__card">
    <h2 class="job-create__title">New Job</h2>

    <form method="post" enctype="multipart/form-data" class="job-create__form">
      {% csrf_token %}

      <div class="form-group form-group--full">
        <label for="id_logo" class="form-group__label">Company logo</label>
        <div class="job-create__logo-section">
          <div class="job-create__logo-preview">
            <img src="{% static 'img/default.png' %}" alt="Default logo" class="job-create__logo-img" id="logo-preview">
          </div>
          <div class="job-create__file-info">
            <label for="id_logo" class="job-create__file-btn">Select file</label>
            <span class="job-create__file-name" id="file-name">Ningún archivo seleccionado</span>
          </div>
          {{ form.logo }}
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="id_company" class="form-group__label">Company</label>
          {{ form.company }}
        </div>
        <div class="form-group">
          <label for="id_title" class="form-group__label">Job Title</label>
          {{ form.title }}
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="id_location" class="form-group__label">Location</label>
          {{ form.location }}
        </div>
        <div class="form-group">
          <label for="id_employment_type" class="form-group__label">Employment Type</label>
          {{ form.employment_type }}
        </div>
      </div>

      <div class="form-group form-group--full">
        <label for="quill-editor" class="form-group__label">Job Description</label>
        <div class="job-create__editor">
          <div id="quill-editor" class="job-create__editor-content"></div>
        </div>
        {{ form.description }}
      </div>

      <div class="job-create__actions">
        <button type="submit" class="btn-create">Create</button>
      </div>
    </form>
  </article>
</section>

<script>
  const quill = new Quill('#quill-editor', { theme: 'snow' });

  const form = document.querySelector('form');
  form.onsubmit = function() {
    document.querySelector('input[name="description"]').value = quill.root.innerHTML;
  };

  const fileInput = document.getElementById('id_logo');
  const fileName = document.getElementById('file-name');
  const logoPreview = document.getElementById('logo-preview');

  fileInput.addEventListener('change', function(e) {
    if (this.files && this.files[0]) {
      fileName.textContent = this.files[0].name;

      const reader = new FileReader();
      reader.onload = function(e) {
        logoPreview.src = e.target.result;
      };
      reader.readAsDataURL(this.files[0]);
    } else {
      fileName.textContent = 'Ningún archivo seleccionado';
    }
  });
</script>
{% endblock %}
