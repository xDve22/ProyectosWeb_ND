{% extends "base.html" %} {% block title %}Editar {{ job.title }}{% endblock %}
{% load static %}

{% block head %}
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
{% endblock %}

{% block content %}
  <h1>Editar oferta</h1>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %} {{ form.company }} {{ form.title }} {{ form.location }}
    {{ form.employment_type }}
    <label for="id_logo">Company logo:</label>
    {% if job.company.logo %}
      <img
        src="{{ job.company.logo }}"
        alt="{{ job.company.name }}"
        width="80"
        style="display: block; margin-bottom: 10px"
      />
    {% else %}
      <img
        src="{% static 'img/default.png' %}"
        alt="Default logo"
        width="80"
        style="display: block; margin-bottom: 10px"
      />
    {% endif %}
    {{ form.logo }}

    <!-- Quill -->
    <div id="quill-editor" style="height: 200px"></div>
    {{ form.description }}

    <button type="submit">Guardar</button>
    <a href="{% url 'jobs:job_detail' job.pk %}">Cancelar</a>
  </form>

  {{ job.description|json_script:"jobDesc" }}

  <script>
    const quill = new Quill('#quill-editor', { theme: 'snow' });

    const existingDesc = JSON.parse(document.getElementById('jobDesc').textContent);
    quill.root.innerHTML = existingDesc;

    const form = document.querySelector('form');
    form.onsubmit = function () {
      document.querySelector('input[name="description"]').value = quill.root.innerHTML;
    };
  </script>
{% endblock %}
